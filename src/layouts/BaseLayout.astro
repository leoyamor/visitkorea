---
import { withLang, type SupportedLang } from "../lib/i18n";
import { absoluteUrl } from "../lib/site";

const {
  title = "Visit Korea Planner",
  description = "Practical travel guidance for foreigners visiting Korea.",
  bodyClass = "",
  lang = "en",
  canonicalUrl = absoluteUrl("/"),
  alternateEnUrl = absoluteUrl("/"),
  alternateEsUrl = absoluteUrl(withLang("/", "es")),
  noindex = false,
} = Astro.props as {
  title?: string;
  description?: string;
  bodyClass?: string;
  lang?: SupportedLang;
  canonicalUrl?: string;
  alternateEnUrl?: string;
  alternateEsUrl?: string;
  noindex?: boolean;
};

---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <link rel="icon" href="/favicon.ico" />
    <meta name="description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content="Visit Korea Planner" />
    <meta name="twitter:card" content="summary_large_image" />
    {noindex ? <meta name="robots" content="noindex, nofollow" /> : null}
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" hreflang="en" href={alternateEnUrl} />
    <link rel="alternate" hreflang="es" href={alternateEsUrl} />
    <link rel="alternate" hreflang="x-default" href={alternateEnUrl} />
    <title>{title}</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap");

      :root {
        color-scheme: dark;
        --bg-0: #120e0b;
        --bg-1: #1a120e;
        --bg-2: #0f0b09;

        --text-strong: #f7f3ee;
        --text-soft: #e7e2da;
        --text-muted: #c9c1b6;

        --ink-strong: #171412;
        --ink-soft: #4a433c;

        --paper: #f5f0e8;
        --paper-2: #efe7dc;

        --border-dark: rgba(255, 255, 255, 0.1);
        --border-paper: rgba(23, 20, 18, 0.08);

        --shadow-1: 0 10px 24px rgba(0, 0, 0, 0.28);
        --shadow-2: 0 18px 44px rgba(0, 0, 0, 0.34);
        --radius-xl: 22px;

        --accent: #7c5cff;
        --accent-hover: #6a4ef0;

        --text: var(--text-strong);
        --muted: var(--text-muted);
        --ink: var(--ink-strong);
        --ring: rgba(124, 92, 255, 0.22);
        --shadow: var(--shadow-1);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Work Sans", system-ui, sans-serif;
        color: var(--text-soft);
        background:
          radial-gradient(1200px 600px at 20% -10%, rgba(255, 255, 255, 0.06), transparent 55%),
          linear-gradient(180deg, var(--bg-1), var(--bg-2));
        min-height: 100vh;
      }

      body.page--sub {
        background:
          radial-gradient(1200px 600px at 20% -10%, rgba(255, 255, 255, 0.06), transparent 55%),
          linear-gradient(180deg, var(--bg-1), var(--bg-2));
      }

      body.page--leaf {
        background:
          radial-gradient(1200px 600px at 20% -10%, rgba(255, 255, 255, 0.06), transparent 55%),
          linear-gradient(180deg, var(--bg-1), var(--bg-2));
      }

      body.home-bg {
        background:
          radial-gradient(1200px 600px at 20% -10%, rgba(255, 255, 255, 0.06), transparent 55%),
          linear-gradient(180deg, rgba(18, 14, 11, 0.3), rgba(18, 14, 11, 0.5)),
          linear-gradient(180deg, var(--bg-1), var(--bg-2)),
          url("/hero.webp");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      body.page--sub main {
        background: transparent;
        border-radius: 0;
        border: none;
        box-shadow: none;
        padding: 48px 36px 80px;
      }

      body.page--leaf main {
        background: transparent;
        border-radius: 0;
        border: none;
        box-shadow: none;
        padding: 48px 36px 80px;
      }

      @media (max-width: 720px) {
        body.page--sub main,
        body.page--leaf main {
          padding: 32px 18px 64px;
        }
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      h1,
      h2,
      h3 {
        color: var(--text-strong);
      }

      p,
      li {
        color: var(--text-soft);
      }

      .small,
      .muted {
        color: var(--text-muted);
      }

      main {
        width: min(1100px, 92vw);
        margin: 0 auto;
        padding: 48px 0 80px;
      }

      .skip-link {
        position: absolute;
        left: -999px;
        top: 0;
      }

      .skip-link:focus {
        left: 16px;
        top: 16px;
        background: #fff;
        padding: 8px 12px;
        border-radius: 999px;
        box-shadow: var(--shadow);
      }

      @media (max-width: 720px) {
        main {
          padding: 32px 0 64px;
        }
      }

      #google_translate_element {
        position: absolute;
        width: 0;
        height: 0;
        overflow: hidden;
        opacity: 0;
        pointer-events: none;
      }

    </style>
  </head>
  <body class={bodyClass}>
    <a href="#content" class="skip-link">Skip to content</a>
    <div id="google_translate_element" aria-hidden="true"></div>
    <main id="content">
      <slot />
    </main>
    <script is:inline define:vars={{ lang }}>
      (() => {
        const url = new URL(window.location.href);
        const queryLang = url.searchParams.get("lang");

        const activeLang = queryLang === "es" || lang === "es" ? "es" : "en";
        const googValue = activeLang === "es" ? "/auto/es" : "/auto/en";

        document.cookie = `googtrans=${googValue};path=/;max-age=31536000`;
        document.cookie = `googtrans=${googValue};path=/;domain=${location.hostname};max-age=31536000`;

        if (activeLang === "en" && url.hash.startsWith("#googtrans")) {
          url.hash = "";
          window.history.replaceState({}, "", url.toString());
        }

        if (activeLang !== "es") {
          return;
        }

        const initTranslate = () => {
          if (!window.google || !window.google.translate || !window.google.translate.TranslateElement) {
            return;
          }
          new window.google.translate.TranslateElement(
            {
              pageLanguage: "en",
              includedLanguages: "en,es",
              autoDisplay: false,
            },
            "google_translate_element"
          );
        };

        if (window.google && window.google.translate && window.google.translate.TranslateElement) {
          initTranslate();
          return;
        }

        window.googleTranslateElementInit = initTranslate;

        const existingScript = document.querySelector("script[data-google-translate]");
        if (existingScript) {
          return;
        }

        const script = document.createElement("script");
        script.src = "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
        script.async = true;
        script.defer = true;
        script.setAttribute("data-google-translate", "true");
        document.head.appendChild(script);
      })();
    </script>
  </body>
</html>
